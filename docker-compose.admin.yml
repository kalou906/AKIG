# docker-compose.admin.yml
# Services d'administration: Portainer, pgAdmin, RedisInsight
version: '3.8'

services:
  # Portainer - Gestion Docker UI
  portainer:
    image: portainer/portainer-ce:latest
    container_name: akig-portainer
    command: -H unix:///var/run/docker.sock
    ports:
      - "9000:9000"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer-data:/data
    networks:
      - akig-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.portainer.rule=Host(`portainer.akig.local`)"
      - "traefik.http.routers.portainer.entrypoints=websecure"
      - "traefik.http.routers.portainer.tls.certresolver=letsencrypt"
      - "traefik.http.services.portainer.loadbalancer.server.port=9000"
    restart: unless-stopped

  # pgAdmin - PostgreSQL UI
  pgadmin:
    image: dpage/pgadmin4:latest
    container_name: akig-pgadmin
    environment:
      PGADMIN_DEFAULT_EMAIL: ${PGADMIN_EMAIL:-admin@akig.com}
      PGADMIN_DEFAULT_PASSWORD: ${PGADMIN_PASSWORD:-admin123}
      PGADMIN_CONFIG_SERVER_MODE: "False"
      PGADMIN_CONFIG_MASTER_PASSWORD_REQUIRED: "False"
    ports:
      - "5050:80"
    volumes:
      - pgadmin-data:/var/lib/pgadmin
      - ./pgadmin/servers.json:/pgadmin4/servers.json # Pré-configuration
    networks:
      - akig-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.pgadmin.rule=Host(`pgadmin.akig.local`)"
      - "traefik.http.routers.pgadmin.entrypoints=websecure"
      - "traefik.http.routers.pgadmin.tls.certresolver=letsencrypt"
      - "traefik.http.services.pgadmin.loadbalancer.server.port=80"
    depends_on:
      - postgres
    restart: unless-stopped

  # RedisInsight - Redis UI
  redisinsight:
    image: redis/redisinsight:latest
    container_name: akig-redisinsight
    ports:
      - "5540:5540"
    volumes:
      - redisinsight-data:/db
    networks:
      - akig-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.redisinsight.rule=Host(`redis.akig.local`)"
      - "traefik.http.routers.redisinsight.entrypoints=websecure"
      - "traefik.http.routers.redisinsight.tls.certresolver=letsencrypt"
      - "traefik.http.services.redisinsight.loadbalancer.server.port=5540"
    depends_on:
      - redis
    restart: unless-stopped

  # Adminer - DB Universal UI (alternative légère à pgAdmin)
  adminer:
    image: adminer:latest
    container_name: akig-adminer
    environment:
      ADMINER_DEFAULT_SERVER: postgres
      ADMINER_DESIGN: dracula
    ports:
      - "8081:8080"
    networks:
      - akig-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.adminer.rule=Host(`adminer.akig.local`)"
      - "traefik.http.routers.adminer.entrypoints=websecure"
      - "traefik.http.routers.adminer.tls.certresolver=letsencrypt"
      - "traefik.http.services.adminer.loadbalancer.server.port=8080"
    depends_on:
      - postgres
    restart: unless-stopped
  # Nginx Proxy Manager (alternative à Traefik)
  # nginx-proxy-manager:
  #   image: 'jc21/nginx-proxy-manager:latest'
  #   container_name: akig-npm
  #   ports:
  #     - '80:80'
  #     - '443:443'
  #     - '81:81'
  #   volumes:
  #     - npm-data:/data
  #     - npm-letsencrypt:/etc/letsencrypt
  #   networks:
  #     - akig-network
  #   restart: unless-stopped

networks:
  akig-network:
    external: true # Utiliser le réseau créé par docker-compose.traefik.yml

volumes:
  portainer-data:
  pgadmin-data:
  redisinsight-data:
    # npm-data:
    # npm-letsencrypt:
